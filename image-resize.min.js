(function(){var exports={};
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||false;s.configurable=true;if("value"in s)s.writable=true;Object.defineProperty(e,s.key,s)}}return function(t,i,s){if(i)e(t.prototype,i);if(s)e(t,s);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var ImageResize=exports.ImageResize=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,e);this.quill=t;this.options=i;this.handleClick=this.handleClick.bind(this);this.handleMousedown=this.handleMousedown.bind(this);this.handleMouseup=this.handleMouseup.bind(this);this.handleDrag=this.handleDrag.bind(this);this.checkImage=this.checkImage.bind(this);this.boxes=[];document.execCommand("enableObjectResizing",false,"false");this.quill.root.addEventListener("click",this.handleClick,false)}_createClass(e,[{key:"handleClick",value:function e(t){if(t.target&&t.target.tagName&&t.target.tagName.toUpperCase()=="IMG"){if(this.img===t.target){return}if(this.img){this.hide()}this.show(t.target)}else if(this.img){this.hide()}}},{key:"show",value:function e(t){this.img=t;this.showResizers();this.showSizeDisplay();var i=this.img.getBoundingClientRect();this.positionBoxes(i);this.positionSizeDisplay(i)}},{key:"hide",value:function e(){this.hideResizers();this.hideSizeDisplay();this.img=undefined}},{key:"showResizers",value:function e(){this.setUserSelect("none");this.addBox("nwse-resize");this.addBox("nesw-resize");this.addBox("nwse-resize");this.addBox("nesw-resize");document.addEventListener("keyup",this.checkImage,true);this.quill.root.addEventListener("input",this.checkImage,true)}},{key:"hideResizers",value:function e(){document.removeEventListener("keyup",this.checkImage);this.quill.root.removeEventListener("input",this.checkImage);this.setUserSelect("");this.setCursor("");this.boxes.forEach(function(e){return document.body.removeChild(e)});this.dragBox=undefined;this.dragStartX=undefined;this.preDragWidth=undefined;this.boxes=[]}},{key:"addBox",value:function e(t){var i=document.createElement("div");var s={position:"absolute",height:"12px",width:"12px",backgroundColor:"white",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80",cursor:t};this.extend(i.style,s,this.options.handleStyles||{});i.addEventListener("mousedown",this.handleMousedown,false);document.body.appendChild(i);this.boxes.push(i)}},{key:"extend",value:function e(t){for(var i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++){s[n-1]=arguments[n]}s.forEach(function(e){for(var i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}});return t}},{key:"positionBoxes",value:function e(t){var i=this;[{left:t.left-6,top:t.top-6},{left:t.left+t.width-6,top:t.top-6},{left:t.left+t.width-6,top:t.top+t.height-6},{left:t.left-6,top:t.top+t.height-6}].forEach(function(e,t){i.extend(i.boxes[t].style,{top:Math.round(e.top+window.pageYOffset)+"px",left:Math.round(e.left+window.pageXOffset)+"px"})})}},{key:"handleMousedown",value:function e(t){this.dragBox=t.target;this.dragStartX=t.clientX;this.preDragWidth=this.img.width||this.img.naturalWidth;this.setCursor(this.dragBox.style.cursor);document.addEventListener("mousemove",this.handleDrag,false);document.addEventListener("mouseup",this.handleMouseup,false)}},{key:"handleMouseup",value:function e(){this.setCursor("");document.removeEventListener("mousemove",this.handleDrag);document.removeEventListener("mouseup",this.handleMouseup)}},{key:"handleDrag",value:function e(t){if(!this.img){return}if(this.dragBox==this.boxes[0]||this.dragBox==this.boxes[3]){this.img.width=Math.round(this.preDragWidth-t.clientX-this.dragStartX)}else{this.img.width=Math.round(this.preDragWidth+t.clientX-this.dragStartX)}var i=this.img.getBoundingClientRect();this.positionBoxes(i);this.positionSizeDisplay(i)}},{key:"setUserSelect",value:function e(t){var i=this;["userSelect","mozUserSelect","webkitUserSelect","msUserSelect"].forEach(function(e){i.quill.root.style[e]=t;document.documentElement.style[e]=t})}},{key:"setCursor",value:function e(t){[document.body,this.img,this.quill.root].forEach(function(e){return e.style.cursor=t})}},{key:"checkImage",value:function e(){if(this.img){this.hide()}}},{key:"showSizeDisplay",value:function e(){if(!this.options.displaySize){return}this.display=document.createElement("div");var t={position:"absolute",font:"12px/1.0 Arial, Helvetica, sans-serif",padding:"4px 8px",textAlign:"center",backgroundColor:"white",color:"#333",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80",cursor:"default"};this.extend(this.display.style,t,this.options.displayStyles||{});document.body.appendChild(this.display)}},{key:"hideSizeDisplay",value:function e(){document.body.removeChild(this.display);this.display=undefined}},{key:"positionSizeDisplay",value:function e(t){if(!this.display||!this.img){return}var i=this.getCurrentSize();this.display.innerHTML=i.join(" &times; ");if(i[0]>120&&i[1]>30){var s=this.display.getBoundingClientRect();this.extend(this.display.style,{left:Math.round(t.left+t.width+window.pageXOffset-s.width-8)+"px",top:Math.round(t.top+t.height+window.pageYOffset-s.height-8)+"px"})}else{this.extend(this.display.style,{left:Math.round(t.left+t.width+window.pageXOffset+8)+"px",top:Math.round(t.top+t.height+window.pageYOffset+8)+"px"})}}},{key:"getCurrentSize",value:function e(){return[this.img.width,Math.round(this.img.width/this.img.naturalWidth*this.img.naturalHeight)]}}]);return e}();
window.Quill.register('modules/imageResize',exports.ImageResize);})();
